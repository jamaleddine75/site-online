<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create QCM Question</title>
  <link rel="stylesheet" href="/les_question.css" />
</head>
<body>
  <div class="container">
    <div class="card">
      <h1 class="title">Create QCM Question</h1>
      <p class="subtitle">Add a multiple choice question</p>

      <form id="qcmForm" action="/auth/qcm_q" method="POST">
        <div class="form-group">
          <label>Question</label>
          <input type="text" id="question" name="qestion" placeholder="Enter your question" required/>
        </div>

        <div class="form-group" id="answersContainer">
          <label>Answers</label>
          <!-- dynamic answers injected here -->
        </div>
        <button type="button" class="add-answer" onclick="addAnswer()">Add Choice</button>

        <div class="form-group grid">
          <div>
            <label>Timer (seconds)</label>
            <input type="number" id="timer" name="time" min="5" max="300" />
          </div>
          <div>
            <label>Points</label>
            <input type="number" id="points" name="pionte" min="1" max="100" />
          </div>
        </div>

        <div class="form-actions">
          <button type="submit">Save Question</button>
          <button type="button" onclick="saveFinale()">Save as Finale</button>
           <button type="button" onclick="window.location.href='/home'">Return Home</button>
        </div>
      </form>
    </div>
  </div>

  <div class="finale-link" id="finaleLink" style="display:none;">
    <p id="finaleUrl"></p>
    <button onclick="copyLink()">Copy Link</button>
  </div>

  <script>
    let answers = [];

    function addAnswer(text = '', isCorrect = false) {
      if (answers.length >= 6) return;
      const index = answers.length;
      const container = document.getElementById('answersContainer');

      const div = document.createElement('div');
      div.className = 'answer-option';
      div.innerHTML = `
        <input type="text" name="chois${index + 1}" placeholder="Choice ${index + 1}" value="${text}" />
        <input type="radio" name="correctAnswer" onclick="setCorrectAnswer(${index})" ${isCorrect ? 'checked' : ''}/>
        <button type="button" onclick="removeAnswer(${index})">Remove</button>
      `;

      answers.push({ element: div, text, isCorrect });
      container.appendChild(div);
    }

    function setCorrectAnswer(index) {
      answers.forEach((a, i) => a.isCorrect = i === index);
    }

    function removeAnswer(index) {
      answers[index].element.remove();
      answers.splice(index, 1);
      renderAnswers();
    }

    function renderAnswers() {
      const container = document.getElementById('answersContainer');
      container.innerHTML = '<label>Answers</label>';
      const temp = [...answers];
      answers = [];
      temp.forEach((a) => addAnswer(a.text, a.isCorrect));
    }

    function saveFinale() {
      const examId = Math.floor(Math.random() * 1000000);
      const url = `https://example.com/finale/${examId}`;
      document.getElementById('finaleUrl').textContent = url;
      document.getElementById('finaleLink').style.display = 'block';
    }

    function copyLink() {
      const link = document.getElementById('finaleUrl').textContent;
      navigator.clipboard.writeText(link);
      alert("Link copied to clipboard!");
    }

    // If you're using client-side preview only, uncomment below
    // If you're submitting to server, let native form handle it
    /*
    document.getElementById('qcmForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const question = document.getElementById('question').value;
      const timer = document.getElementById('timer').value;
      const points = document.getElementById('points').value;

      const output = {
        question,
        type: 'qcm',
        timer,
        points,
        answers: answers.map((a, i) => ({
          text: document.getElementsByName(`chois${i+1}`)[0].value,
          isCorrect: a.isCorrect
        })),
      };

      console.log('Saved QCM:', output);
      alert('QCM question saved! Check console.');
    });
    */

    // Start with 2 answers
    addAnswer();
    addAnswer();
  </script>

  {{#if message}}
    <h4 class="alert alert-danger mt-4">{{message}}</h4>
  {{/if}}
</body>
</html>
