
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Question</title>
  <link rel="stylesheet" href="/les_question.css"  />

</head>
<body>
  <div class="container" action="/auth/les_question" method="POST" >
    <div class="card">
      <h1 class="title">Create Question</h1>
      <p class="subtitle">Add a new question with answers and settings</p>

      <form id="questionForm">
        <div class="form-group">
          <label for="question">Question</label>
          <input type="text" name="question" placeholder="Enter your question here"/>
        </div>

        <div class="form-group">
          <label>Question Type</label>
          <div class="radio-group">
            <label><input type="radio" name="questionType" value="qcm" checked /> Multiple Choice</label>
            <label><input type="radio" name="questionType" value="direct" /> Direct Answer</label>
          </div>
        </div>

        <div id="multipleChoiceSection">
          <div class="form-group" name="answersContainer">
            <label>Answers</label>
          </div>
          <button type="button" class="add-answer" onclick="addAnswer()">Ajouter un choix</button>
        </div>

        <div id="directAnswerSection" class="form-group" style="display:none">
          <label for="directAnswer">Correct Answer</label>
          <input type="text" name="directAnswer" placeholder="Enter the correct answer"/>
        </div>

        <div class="form-group grid">
          <div>
            <label for="timer">Timer (seconds)</label>
            <input type="number" name="timer" min="5" max="300" />
          </div>
          <div>
            <label for="points">Points</label>
            <input type="number" name="points" min="1" max="100" />
          </div>
        </div>

        <div class="form-actions">
          <button type="submit">Save Question</button>
          <button type="button" onclick="saveFinale()">Save as Finale</button>
        </div>

        <div class="finale-link" id="finaleLink">
          <p id="finaleUrl">https://example.com/finale/123456</p>
          <button onclick="copyLink()">Copy Link</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let answers = [];
    let correctAnswerIndex = null;

    function addAnswer(text = '', isCorrect = false) {
      if (answers.length >= 4) return;
      const index = answers.length;
      const container = document.getElementById('answersContainer');

      const div = document.createElement('div');
      div.className = 'answer-option';
      div.innerHTML = `
        <input type="text" placeholder="Answer ${index + 1}" value="${text}" oninput="updateAnswer(${index}, this.value)" />
        <input type="radio" name="correctAnswer" onclick="setCorrectAnswer(${index})" ${isCorrect ? 'checked' : ''}/>
        <button type="button" onclick="removeAnswer(${index})">Remove</button>
      `;

      answers.push({ element: div, text, isCorrect });
      container.appendChild(div);
    }

    function updateAnswer(index, text) {
      answers[index].text = text;
    }

    function setCorrectAnswer(index) {
      correctAnswerIndex = index;
      answers.forEach((a, i) => a.isCorrect = i === index);
    }

    function removeAnswer(index) {
      const answer = answers[index];
      if (answer) {
        answer.element.remove();
        answers.splice(index, 1);
        renderAnswers();
      }
    }

    function renderAnswers() {
      const container = document.getElementById('answersContainer');
      container.innerHTML = '<label>Answers</label>';
      const temp = [...answers];
      answers = [];
      temp.forEach((a) => addAnswer(a.text, a.isCorrect));
    }

    function copyLink() {
      const link = document.getElementById('finaleUrl').textContent;
      navigator.clipboard.writeText(link);
      alert("Link copied to clipboard!");
    }

    function saveFinale() {
      document.getElementById('finaleLink').classList.add('show');
    }

    document.getElementsByName('questionType').forEach(radio => {
      radio.addEventListener('change', (e) => {
        const type = e.target.value;
        document.getElementById('multipleChoiceSection').style.display = type === 'qcm' ? 'block' : 'none';
        document.getElementById('directAnswerSection').style.display = type === 'direct' ? 'block' : 'none';
      });
    });

    document.getElementById('questionForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const question = document.getElementById('question').value;
      const type = [...document.getElementsByName('questionType')].find(r => r.checked).value;
      const timer = document.getElementById('timer').value;
      const points = document.getElementById('points').value;
      const directAnswer = document.getElementById('directAnswer').value;

      const output = {
        question,
        type,
        timer,
        points,
        answers: type === 'qcm' ? answers.map(a => ({ text: a.text, isCorrect: a.isCorrect })) : [],
        directAnswer: type === 'direct' ? directAnswer : null
      };

      console.log('Saved question:', output);
      alert('Question saved! Check console for details.');
    });

    // Init with two empty answer fields
    addAnswer();
    addAnswer();
  </script>
</body>
</html>
