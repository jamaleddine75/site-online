<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Plateforme √©ducative</title>
  <link rel="stylesheet" href="/style-home.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="profile">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Professeur">
        <h2 id="name"></h2>
      </div>
      <nav>
        <ul>
          <li><span>üìù</span>Cr√©er Examen</li>
          <li><span>üìà</span>Passer les examens</li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <h1>Votre espace de cr√©ation d‚Äôexamens est pr√™t üéì</h1>

      <div class="card-list">
        <div class="card" id="createExamCard">
          ‚ûï Cr√©er un nouvel examen
        </div>
        <div class="card" id="passExamCard">
          üìã Passer les examens
        </div>
      </div>
      <h2 style="margin-top: 30px;">Vos examens cr√©√©s</h2>
      <div id="examsList">
        <!-- Exams will be loaded here dynamically -->
        <p class="no-exams">Chargement de vos examens...</p>
      </div>

    </main>
  </div>

 
  <script>
    // Get user name from localStorage
    const userName = localStorage.getItem("name") || "Utilisateur";
    const roleTitle = document.getElementById("name");
   
    if (roleTitle) {
      roleTitle.textContent = userName;
    }

    // Click events
    document.getElementById("createExamCard").addEventListener("click", function() {
      window.location.href = "/create_exam";
    });

    document.getElementById("passExamCard").addEventListener("click", function() {
      window.location.href = "/lien";
    });

    // Function to load user's exams
    async function loadExams() {
      try {
        const response = await fetch('/auth/exams');
        if (!response.ok) {
          throw new Error('Failed to fetch exams');
        }

        const exams = await response.json();
        const examsList = document.getElementById('examsList');

        if (exams.length === 0) {
          examsList.innerHTML = '<p class="no-exams">Vous n\'avez pas encore cr√©√© d\'examens.</p>';
          return;
        }

        examsList.innerHTML = '';
        exams.forEach(exam => {
          const examCard = document.createElement('div');
          examCard.className = 'exam-card';

          examCard.innerHTML = `
            <div>
              <h3>${exam.title}</h3>
              <p>${exam.description || 'Pas de description'}</p>
              <small>Dur√©e: ${exam.time_limit} minutes</small>
            </div>
            <div class="exam-actions">
              <button class="exam-btn modify-btn" data-id="${exam.id}">Modifier</button>
              <button class="exam-btn delete-btn" data-id="${exam.id}">Supprimer</button>
            </div>
          `;

          examsList.appendChild(examCard);
        });

        // Add event listeners for modify buttons
        document.querySelectorAll('.modify-btn').forEach(button => {
          button.addEventListener('click', function() {
            const examId = this.getAttribute('data-id');
            window.location.href = `/modifierexam/${examId}`;
          });
        });

      } catch (error) {
        console.error('Error loading exams:', error);
        document.getElementById('examsList').innerHTML =
          '<p class="no-exams">Erreur lors du chargement de vos examens.</p>';
      }
    }

    // Load exams when page loads
    document.addEventListener('DOMContentLoaded', loadExams);
  </script>

  {{#if message}}
    <h4 class="alert alert-danger mt-4">{{message}}</h4>
  {{/if}}
</body>
</html>
